{"version":3,"file":"Camera.js","sources":["../../../../iwo/src/cameras/Camera.ts"],"sourcesContent":["import { mat4, quat, vec3 } from \"gl-matrix\";\r\n\r\nconst SPEED: number = 200.0;\r\nconst SENSITIVITY: number = 0.005;\r\n\r\nexport enum Camera_Movement {\r\n    FORWARD,\r\n    BACKWARD,\r\n    LEFT,\r\n    RIGHT,\r\n    UP,\r\n    DOWN,\r\n}\r\n\r\nlet forward = vec3.create();\r\nlet right = vec3.create();\r\nconst temp_quat = quat.create();\r\nconst temp = vec3.create();\r\n\r\nconst FORWARD = vec3.fromValues(0, 0, -1);\r\n\r\nexport class Camera {\r\n    public position: vec3;\r\n    public front: vec3;\r\n    public up: vec3;\r\n\r\n    private readonly worldUp: vec3;\r\n    private readonly worldRight: vec3;\r\n\r\n    private readonly movementSpeed: number;\r\n    private readonly mouseSensitivity: number;\r\n\r\n    private pitch: number;\r\n    private heading: number;\r\n\r\n    private readonly orientation: quat;\r\n\r\n    public constructor(pos: vec3, forward: vec3 = FORWARD, up: vec3 = vec3.fromValues(0, 1, 0)) {\r\n        this.position = vec3.clone(pos);\r\n        this.front = vec3.clone(forward);\r\n        vec3.normalize(this.front, this.front);\r\n\r\n        this.worldUp = vec3.fromValues(0, 1, 0);\r\n        this.worldRight = vec3.fromValues(1, 0, 0);\r\n\r\n        this.up = vec3.clone(up);\r\n        vec3.normalize(this.up, this.up);\r\n\r\n        // console.log(this.front);\r\n        // console.log(this.worldRight);\r\n        // console.log(this.up);\r\n\r\n        this.movementSpeed = SPEED;\r\n        this.mouseSensitivity = SENSITIVITY;\r\n\r\n        this.pitch = -Math.asin(this.front[1]);\r\n        this.heading = -(Math.atan2(this.front[0], this.front[2]) - Math.PI);\r\n\r\n        this.orientation = quat.create();\r\n        this.calculateOrientation();\r\n    }\r\n\r\n    public getRight(out?: vec3): vec3 {\r\n        out = out ?? vec3.create();\r\n        quat.conjugate(temp_quat, this.orientation);\r\n        vec3.set(out, 1, 0, 0);\r\n        vec3.transformQuat(out, out, temp_quat);\r\n        return out;\r\n    }\r\n\r\n    public getForward(out: vec3 = vec3.create()): vec3 {\r\n        quat.conjugate(temp_quat, this.orientation);\r\n        vec3.set(out, 0, 0, -1);\r\n        vec3.transformQuat(out, out, temp_quat);\r\n        return out;\r\n    }\r\n\r\n    public lookAt(target: vec3): void {\r\n        vec3.sub(this.front, target, this.position);\r\n        vec3.normalize(this.front, this.front);\r\n        this.pitch = -Math.asin(this.front[1]);\r\n        this.heading = -(Math.atan2(this.front[0], this.front[2]) - Math.PI);\r\n\r\n        this.calculateOrientation();\r\n    }\r\n\r\n    public getViewMatrix(out: mat4): mat4 {\r\n        mat4.fromQuat(out, this.orientation);\r\n        mat4.translate(out, out, vec3.negate(temp, this.position));\r\n        return out;\r\n    }\r\n\r\n    public getInverseViewMatrix(out: mat4): mat4 {\r\n        out = this.getViewMatrix(out);\r\n        mat4.invert(out, out);\r\n        return out;\r\n    }\r\n\r\n    public processKeyboard(direction: Camera_Movement, deltaTime: number): void {\r\n        const velocity: number = this.movementSpeed * deltaTime;\r\n\r\n        forward = this.getForward(forward);\r\n        right = this.getRight(right);\r\n\r\n        if (direction == Camera_Movement.FORWARD) {\r\n            vec3.scaleAndAdd(this.position, this.position, forward, velocity);\r\n        } else if (direction == Camera_Movement.BACKWARD) {\r\n            vec3.scaleAndAdd(this.position, this.position, forward, -velocity);\r\n        } else if (direction == Camera_Movement.LEFT) {\r\n            vec3.scaleAndAdd(this.position, this.position, right, -velocity);\r\n        } else if (direction == Camera_Movement.RIGHT) {\r\n            vec3.scaleAndAdd(this.position, this.position, right, velocity);\r\n        } else if (direction == Camera_Movement.UP) {\r\n            vec3.scaleAndAdd(this.position, this.position, this.worldUp, velocity);\r\n        }\r\n    }\r\n\r\n    public processMouseMovement(xOffset: number, yOffset: number, constrainPitch: boolean = true): void {\r\n        if (xOffset === 0 && yOffset === 0) return;\r\n\r\n        xOffset *= this.mouseSensitivity;\r\n        yOffset *= this.mouseSensitivity;\r\n\r\n        this.heading += xOffset;\r\n        if (this.heading > 2 * Math.PI) this.heading -= 2 * Math.PI;\r\n        if (this.heading < 0) this.heading += 2 * Math.PI;\r\n\r\n        this.pitch += yOffset;\r\n        if (this.pitch > Math.PI) this.pitch -= 2 * Math.PI;\r\n        if (this.pitch < -Math.PI) this.pitch += 2 * Math.PI;\r\n\r\n        if (constrainPitch) {\r\n            if (this.pitch > Math.PI / 2) this.pitch = Math.PI / 2;\r\n            if (this.pitch < -Math.PI / 2) this.pitch = -Math.PI / 2;\r\n        }\r\n\r\n        this.calculateOrientation();\r\n    }\r\n\r\n    private calculateOrientation(): void {\r\n        const pitch_quat = quat.setAxisAngle(quat.create(), this.worldRight, this.pitch);\r\n        const heading_quat = quat.setAxisAngle(quat.create(), this.worldUp, this.heading);\r\n\r\n        quat.identity(this.orientation);\r\n        quat.mul(this.orientation, this.orientation, pitch_quat);\r\n        quat.mul(this.orientation, this.orientation, heading_quat);\r\n\r\n        //   console.log(this.orientation);\r\n        //   console.log(this.getRight(vec3.create()));\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}