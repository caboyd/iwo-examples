{"version":3,"file":"OrbitControl.js","sources":["../../../../iwo/src/cameras/OrbitControl.ts"],"sourcesContent":["import { Camera, Camera_Movement } from \"./Camera\";\r\nimport { mat4, vec3, vec4 } from \"gl-matrix\";\r\n\r\nexport interface OrbitControlOptions {\r\n    mouse_sensitivity?: number;\r\n    orbit_point?: vec3;\r\n    minimum_distance?: number;\r\n}\r\n\r\nexport class OrbitControl {\r\n    private camera: Camera;\r\n\r\n    private target_pitch: number = 0;\r\n    private target_heading: number = 0;\r\n\r\n    private readonly mouse_sensitivity: number = 0.005;\r\n    private readonly step_size: number = 0.5;\r\n    private readonly minimum_distance: number = 5.0;\r\n    public orbit_point: vec3 = [0, 0, 0];\r\n\r\n    public constructor(camera: Camera, options?: OrbitControlOptions) {\r\n        this.camera = camera;\r\n        this.mouse_sensitivity = options?.mouse_sensitivity ?? this.mouse_sensitivity;\r\n        this.orbit_point = options?.orbit_point ?? this.orbit_point;\r\n        this.minimum_distance = options?.minimum_distance ?? this.minimum_distance;\r\n        this.camera.lookAt(this.orbit_point);\r\n    }\r\n\r\n    public update(): void {}\r\n\r\n    // public processKeyboard(direction: Camera_Movement): void {\r\n    //\r\n    //     //move camera\r\n    //     //move orbit point\r\n    //\r\n    //     forward = this.getForward(forward);\r\n    //     right = this.getRight(right);\r\n    //\r\n    //     if (direction == Camera_Movement.FORWARD) {\r\n    //         vec3.scaleAndAdd(this.position, this.position, forward, velocity);\r\n    //     } else if (direction == Camera_Movement.BACKWARD) {\r\n    //         vec3.scaleAndAdd(this.position, this.position, forward, -velocity);\r\n    //     } else if (direction == Camera_Movement.LEFT) {\r\n    //         vec3.scaleAndAdd(this.position, this.position, right, -velocity);\r\n    //     } else if (direction == Camera_Movement.RIGHT) {\r\n    //         vec3.scaleAndAdd(this.position, this.position, right, velocity);\r\n    //     } else if (direction == Camera_Movement.UP) {\r\n    //         vec3.scaleAndAdd(this.position, this.position, this.worldUp, velocity);\r\n    //     }\r\n    // }\r\n\r\n    public scroll(scroll_direction_forward: boolean): void {\r\n        let target_to_camera = vec3.sub(vec3.create(), this.camera.position, this.orbit_point);\r\n        let step_modified_length = vec3.len(target_to_camera);\r\n        step_modified_length += this.step_size * (scroll_direction_forward ? 1 : -1);\r\n        step_modified_length = Math.max(this.minimum_distance, step_modified_length);\r\n\r\n        //Rescale vector\r\n        target_to_camera = vec3.normalize(target_to_camera, target_to_camera);\r\n        target_to_camera = vec3.scale(target_to_camera, target_to_camera, step_modified_length);\r\n\r\n        //Set camera back to scaled vector position\r\n        vec3.add(this.camera.position, this.orbit_point, target_to_camera);\r\n    }\r\n\r\n    public processMouseMovement(xOffset: number, yOffset: number, constrainPitch: boolean = true): void {\r\n        if (xOffset === 0 && yOffset === 0) return;\r\n\r\n        //rotate about orbit_point\r\n\r\n        xOffset *= this.mouse_sensitivity;\r\n        yOffset *= this.mouse_sensitivity;\r\n\r\n        const angle_y = vec3.angle(this.camera.getForward(), this.camera.up);\r\n\r\n        if (constrainPitch) {\r\n            if (angle_y > Math.PI * 0.99 && yOffset < 0) yOffset = 0;\r\n            if (angle_y < Math.PI * 0.01 && yOffset > 0) yOffset = 0;\r\n        }\r\n\r\n        this.rotateAroundTarget(this.orbit_point, xOffset, yOffset);\r\n    }\r\n\r\n    private rotateAroundTarget(target: vec3, x: number, y: number): void {\r\n        //pitch up down\r\n        let new_pos = vec3.sub(vec3.create(), this.camera.position, target);\r\n\r\n        const m = mat4.create();\r\n\r\n        //pitch up down\r\n        mat4.rotate(m, m, y, this.camera.getRight());\r\n        //yaw left right\r\n        mat4.rotate(m, m, x, this.camera.up);\r\n\r\n        let p = vec4.fromValues(new_pos[0], new_pos[1], new_pos[2], 1);\r\n        p = vec4.transformMat4(p, p, m);\r\n        vec3.set(new_pos, p[0], p[1], p[2]);\r\n\r\n        new_pos = vec3.add(new_pos, new_pos, target);\r\n        this.camera.position = new_pos;\r\n        this.camera.lookAt(target);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;MASa,YAAY;IAWrB,YAAmB,MAAc,EAAE,OAA6B;QARxD,iBAAY,GAAW,CAAC,CAAC;QACzB,mBAAc,GAAW,CAAC,CAAC;QAElB,sBAAiB,GAAW,KAAK,CAAC;QAClC,cAAS,GAAW,GAAG,CAAC;QACxB,qBAAgB,GAAW,GAAG,CAAC;QACzC,gBAAW,GAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAGjC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,iBAAiB,GAAG,OAAO,EAAE,iBAAiB,IAAI,IAAI,CAAC,iBAAiB,CAAC;QAC9E,IAAI,CAAC,WAAW,GAAG,OAAO,EAAE,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC;QAC5D,IAAI,CAAC,gBAAgB,GAAG,OAAO,EAAE,gBAAgB,IAAI,IAAI,CAAC,gBAAgB,CAAC;QAC3E,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;KACxC;IAEM,MAAM,MAAW;;;;;;;;;;;;;;;;;;;;;IAuBjB,MAAM,CAAC,wBAAiC;QAC3C,IAAI,gBAAgB,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACvF,IAAI,oBAAoB,GAAG,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACtD,oBAAoB,IAAI,IAAI,CAAC,SAAS,IAAI,wBAAwB,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAC7E,oBAAoB,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,EAAE,oBAAoB,CAAC,CAAC;;QAG7E,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC,gBAAgB,EAAE,gBAAgB,CAAC,CAAC;QACtE,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE,gBAAgB,EAAE,oBAAoB,CAAC,CAAC;;QAGxF,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,EAAE,gBAAgB,CAAC,CAAC;KACtE;IAEM,oBAAoB,CAAC,OAAe,EAAE,OAAe,EAAE,iBAA0B,IAAI;QACxF,IAAI,OAAO,KAAK,CAAC,IAAI,OAAO,KAAK,CAAC;YAAE,OAAO;;QAI3C,OAAO,IAAI,IAAI,CAAC,iBAAiB,CAAC;QAClC,OAAO,IAAI,IAAI,CAAC,iBAAiB,CAAC;QAElC,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAErE,IAAI,cAAc,EAAE;YAChB,IAAI,OAAO,GAAG,IAAI,CAAC,EAAE,GAAG,IAAI,IAAI,OAAO,GAAG,CAAC;gBAAE,OAAO,GAAG,CAAC,CAAC;YACzD,IAAI,OAAO,GAAG,IAAI,CAAC,EAAE,GAAG,IAAI,IAAI,OAAO,GAAG,CAAC;gBAAE,OAAO,GAAG,CAAC,CAAC;SAC5D;QAED,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;KAC/D;IAEO,kBAAkB,CAAC,MAAY,EAAE,CAAS,EAAE,CAAS;;QAEzD,IAAI,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QAEpE,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;;QAGxB,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;;QAE7C,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAErC,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC/D,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAChC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEpC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;QAC7C,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,OAAO,CAAC;QAC/B,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;KAC9B;;;;;"}