{"version":3,"file":"Mesh.js","sources":["../../../../iwo/src/meshes/Mesh.ts"],"sourcesContent":["/*\r\n    Base Mesh Class\r\n    A Mesh Contains:\r\n            \r\n */\r\n\r\nimport { AttributeType, Geometry, Group } from \"geometry/Geometry\";\r\nimport { DrawMode } from \"graphics/WebglConstants\";\r\nimport { IndexBuffer } from \"graphics/IndexBuffer\";\r\nimport { VertexBuffer } from \"graphics/VertexBuffer\";\r\nimport { SubMesh } from \"./SubMesh\";\r\nimport { BufferedGeometry } from \"geometry/BufferedGeometry\";\r\n\r\nexport class Mesh {\r\n    public readonly index_buffer: IndexBuffer | undefined;\r\n    public readonly vertex_buffer: VertexBuffer;\r\n\r\n    public draw_mode: DrawMode;\r\n    public readonly sub_meshes: SubMesh[];\r\n    public count: number;\r\n\r\n    public constructor(gl: WebGL2RenderingContext, geometry: Geometry | BufferedGeometry) {\r\n        let buf_geom: BufferedGeometry = geometry as BufferedGeometry;\r\n        if (geometry instanceof Geometry) {\r\n            buf_geom =\r\n                geometry.getBufferedGeometry !== undefined\r\n                    ? geometry.getBufferedGeometry()\r\n                    : BufferedGeometry.fromGeometry(geometry as Geometry);\r\n        }\r\n\r\n        if (buf_geom.index_buffer !== undefined) this.index_buffer = new IndexBuffer(gl, buf_geom);\r\n        this.vertex_buffer = new VertexBuffer(gl, buf_geom);\r\n\r\n        this.sub_meshes = [];\r\n        this.draw_mode = DrawMode.TRIANGLES;\r\n        this.count = 0;\r\n\r\n        if (buf_geom.groups === undefined || buf_geom.groups.length == 0) {\r\n            //If a geometry has no groups we can assume:\r\n            //  count is indices count or vertices count /3\r\n            //  material is 0\r\n            //  offset is 0\r\n            this.count =\r\n                buf_geom.index_buffer !== undefined\r\n                    ? buf_geom.index_buffer.buffer.length\r\n                    : buf_geom.buffers[buf_geom.attributes[AttributeType.Vertex].buffer_index].buffer.length / 3;\r\n            this.sub_meshes.push(new SubMesh(0, 0, this.count, this.vertex_buffer, this.index_buffer));\r\n        } else {\r\n            for (const group of buf_geom.groups) {\r\n                this.count += group.count;\r\n                this.sub_meshes.push(\r\n                    new SubMesh(group.material_index, group.offset, group.count, this.vertex_buffer, this.index_buffer)\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    public setDrawMode(mode: DrawMode): void {\r\n        this.draw_mode = mode;\r\n    }\r\n\r\n    public destroy(gl: WebGL2RenderingContext): void {\r\n        for (const sub_mesh of this.sub_meshes) {\r\n            sub_mesh.destroy();\r\n        }\r\n\r\n        if (this.index_buffer) this.index_buffer.destroy(gl);\r\n        this.vertex_buffer.destroy(gl);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;MAaa,IAAI;IACG,YAAY,CAA0B;IACtC,aAAa,CAAe;IAErC,SAAS,CAAW;IACX,UAAU,CAAY;IAC/B,KAAK,CAAS;IAErB,YAAmB,EAA0B,EAAE,QAAqC;QAChF,IAAI,QAAQ,GAAqB,QAA4B,CAAC;QAC9D,IAAI,QAAQ,YAAY,QAAQ,EAAE;YAC9B,QAAQ;gBACJ,QAAQ,CAAC,mBAAmB,KAAK,SAAS;sBACpC,QAAQ,CAAC,mBAAmB,EAAE;sBAC9B,gBAAgB,CAAC,YAAY,CAAC,QAAoB,CAAC,CAAC;SACjE;QAED,IAAI,QAAQ,CAAC,YAAY,KAAK,SAAS;YAAE,IAAI,CAAC,YAAY,GAAG,IAAI,WAAW,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;QAC3F,IAAI,CAAC,aAAa,GAAG,IAAI,YAAY,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;QAEpD,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,SAAS,qBAAsB;QACpC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QAEf,IAAI,QAAQ,CAAC,MAAM,KAAK,SAAS,IAAI,QAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE;;;;;YAK9D,IAAI,CAAC,KAAK;gBACN,QAAQ,CAAC,YAAY,KAAK,SAAS;sBAC7B,QAAQ,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM;sBACnC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;YACrG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;SAC9F;aAAM;YACH,KAAK,MAAM,KAAK,IAAI,QAAQ,CAAC,MAAM,EAAE;gBACjC,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC;gBAC1B,IAAI,CAAC,UAAU,CAAC,IAAI,CAChB,IAAI,OAAO,CAAC,KAAK,CAAC,cAAc,EAAE,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,YAAY,CAAC,CACtG,CAAC;aACL;SACJ;KACJ;IAEM,WAAW,CAAC,IAAc;QAC7B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;KACzB;IAEM,OAAO,CAAC,EAA0B;QACrC,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,UAAU,EAAE;YACpC,QAAQ,CAAC,OAAO,EAAE,CAAC;SACtB;QAED,IAAI,IAAI,CAAC,YAAY;YAAE,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QACrD,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KAClC;;;;;"}