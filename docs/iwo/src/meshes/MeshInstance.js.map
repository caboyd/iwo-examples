{"version":3,"file":"MeshInstance.js","sources":["../../../../iwo/src/meshes/MeshInstance.ts"],"sourcesContent":["import { Mesh } from \"./Mesh\";\r\nimport { Material } from \"materials/Material\";\r\nimport { mat3, mat4 } from \"gl-matrix\";\r\nimport { Renderer } from \"../graphics/Renderer\";\r\n\r\nexport class MeshInstance {\r\n    public mesh: Mesh;\r\n    public materials: Material[] | Material;\r\n\r\n    public model_matrix: mat4;\r\n\r\n    public constructor(mesh: Mesh, materials: Material[] | Material) {\r\n        this.mesh = mesh;\r\n        this.materials = materials;\r\n\r\n        this.model_matrix = mat4.create();\r\n    }\r\n\r\n    public render(renderer: Renderer, view_matrix: mat4, proj_matrix: mat4): void {\r\n        renderer.setPerModelUniforms(this.model_matrix, view_matrix, proj_matrix);\r\n\r\n        if (Array.isArray(this.materials)) {\r\n            for (const i of this.materials.keys()) {\r\n                const mat = this.materials[i];\r\n                for (const submesh of this.mesh.sub_meshes) {\r\n                    if (submesh.material_index === i) {\r\n                        renderer.draw(\r\n                            this.mesh.draw_mode,\r\n                            submesh.count,\r\n                            submesh.offset,\r\n                            submesh.index_buffer,\r\n                            submesh.vertex_buffer,\r\n                            mat\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            renderer.draw(\r\n                this.mesh.draw_mode,\r\n                this.mesh.count,\r\n                0,\r\n                this.mesh.index_buffer,\r\n                this.mesh.vertex_buffer,\r\n                this.materials\r\n            );\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;MAKa,YAAY;IAMrB,YAAmB,IAAU,EAAE,SAAgC;QAC3D,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAE3B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;KACrC;IAEM,MAAM,CAAC,QAAkB,EAAE,WAAiB,EAAE,WAAiB;QAClE,QAAQ,CAAC,mBAAmB,CAAC,IAAI,CAAC,YAAY,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;QAE1E,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE;YAC/B,KAAK,MAAM,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE;gBACnC,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC9B,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;oBACxC,IAAI,OAAO,CAAC,cAAc,KAAK,CAAC,EAAE;wBAC9B,QAAQ,CAAC,IAAI,CACT,IAAI,CAAC,IAAI,CAAC,SAAS,EACnB,OAAO,CAAC,KAAK,EACb,OAAO,CAAC,MAAM,EACd,OAAO,CAAC,YAAY,EACpB,OAAO,CAAC,aAAa,EACrB,GAAG,CACN,CAAC;qBACL;iBACJ;aACJ;SACJ;aAAM;YACH,QAAQ,CAAC,IAAI,CACT,IAAI,CAAC,IAAI,CAAC,SAAS,EACnB,IAAI,CAAC,IAAI,CAAC,KAAK,EACf,CAAC,EACD,IAAI,CAAC,IAAI,CAAC,YAAY,EACtB,IAAI,CAAC,IAAI,CAAC,aAAa,EACvB,IAAI,CAAC,SAAS,CACjB,CAAC;SACL;KACJ;;;;;"}