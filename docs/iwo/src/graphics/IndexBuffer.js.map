{"version":3,"file":"IndexBuffer.js","sources":["../../../../iwo/src/graphics/IndexBuffer.ts"],"sourcesContent":["import { Geometry } from \"geometry/Geometry\";\r\nimport { ReferenceCounter } from \"helpers/ReferenceCounter\";\r\nimport { WebGL } from \"./WebglHelper\";\r\nimport { BufferedGeometry } from \"geometry/BufferedGeometry\";\r\n\r\nexport class IndexBuffer {\r\n    public readonly EBO: WebGLBuffer;\r\n    public readonly indices: Uint16Array | Uint32Array;\r\n    public readonly references: ReferenceCounter;\r\n\r\n    public constructor(gl: WebGL2RenderingContext, geometry: BufferedGeometry, stop?: boolean) {\r\n        if (geometry.index_buffer === undefined)\r\n            throw new Error(\"Cannot create IndexBuffer. Geometry.index_buffer is undefined.\");\r\n\r\n        const b = geometry.index_buffer.buffer;\r\n        this.indices = b.BYTES_PER_ELEMENT == 2 ? (b as Uint16Array) : (b as Uint32Array);\r\n        this.EBO = stop ? gl.createBuffer()! : WebGL.buildBuffer(gl, gl.ELEMENT_ARRAY_BUFFER, b);\r\n        this.references = new ReferenceCounter();\r\n    }\r\n\r\n    public bind(gl: WebGL2RenderingContext): void {\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.EBO);\r\n    }\r\n\r\n    public destroy(gl: WebGL2RenderingContext): void {\r\n        if (this.references.count !== 0) {\r\n            console.warn(this);\r\n            console.warn(\"Can't destroy while still being referenced\");\r\n        } else {\r\n            gl.deleteBuffer(this.EBO);\r\n        }\r\n    }\r\n}\r\n"],"names":["ReferenceCounter"],"mappings":";;;MAKa,WAAW;IAKpB,YAAmB,EAA0B,EAAE,QAA0B,EAAE,IAAc;QACrF,IAAI,QAAQ,CAAC,YAAY,KAAK,SAAS;YACnC,MAAM,IAAI,KAAK,CAAC,gEAAgE,CAAC,CAAC;QAEtF,MAAM,CAAC,GAAG,QAAQ,CAAC,YAAY,CAAC,MAAM,CAAC;QACvC,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,iBAAiB,IAAI,CAAC,GAAI,CAAiB,GAAI,CAAiB,CAAC;QAClF,IAAI,CAAC,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC,YAAY,EAAG,GAAG,KAAK,CAAC,WAAW,CAAC,EAAE,EAAE,EAAE,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC;QACzF,IAAI,CAAC,UAAU,GAAG,IAAIA,kBAAgB,EAAE,CAAC;KAC5C;IAEM,IAAI,CAAC,EAA0B;QAClC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,oBAAoB,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;KACpD;IAEM,OAAO,CAAC,EAA0B;QACrC,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,KAAK,CAAC,EAAE;YAC7B,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACnB,OAAO,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAC;SAC9D;aAAM;YACH,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC7B;KACJ;;;;;"}