{"version":3,"file":"Texture2D.js","sources":["../../../../iwo/src/graphics/Texture2D.ts"],"sourcesContent":["import { TextureHelper } from \"./TextureHelper\";\r\nimport { GL } from \"graphics/WebglConstants\";\r\n\r\nexport interface TextureOptions {\r\n    width: number;\r\n    height: number;\r\n    wrap_S: number;\r\n    wrap_T: number;\r\n    wrap_R: number;\r\n    mag_filter: number;\r\n    min_filter: number;\r\n    internal_format: number;\r\n    format: number;\r\n    type: number;\r\n    flip: boolean;\r\n}\r\n\r\nexport const DefaultTextureOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    wrap_S: GL.REPEAT,\r\n    wrap_T: GL.REPEAT,\r\n    wrap_R: GL.REPEAT,\r\n    mag_filter: GL.LINEAR,\r\n    min_filter: GL.LINEAR_MIPMAP_LINEAR,\r\n    internal_format: GL.RGBA,\r\n    format: GL.RGBA,\r\n    type: GL.UNSIGNED_BYTE,\r\n    flip: false,\r\n};\r\n\r\nexport class Texture2D {\r\n    public texture_id: WebGLTexture;\r\n\r\n    public constructor(\r\n        gl: WebGL2RenderingContext,\r\n        source: ArrayBufferView | TexImageSource | undefined = undefined,\r\n        options?: Partial<TextureOptions>\r\n    ) {\r\n        const o: TextureOptions = { ...DefaultTextureOptions, ...options };\r\n        this.texture_id = gl.createTexture()!;\r\n\r\n        if (source instanceof HTMLImageElement && source) {\r\n            if (source.complete && source.src) this.setImage(gl, source, o);\r\n            else {\r\n                //prettier-ignore\r\n                source.addEventListener(\"load\", () => {\r\n                    this.setImage(gl, source,o);\r\n                }, {once: true});\r\n            }\r\n        } else if (source && TextureHelper.isArrayBufferView(source)) {\r\n            //prettier-ignore\r\n            this.setImageByBuffer(gl, source as ArrayBufferView, o);\r\n        } else if (source) {\r\n            //prettier-ignore\r\n            this.setImage(gl, source as TexImageSource, o);\r\n        } else if (o.width !== 0 && o.height !== 0) {\r\n            //prettier-ignore\r\n            //Making empty texture of some width and height because you want to render to it\r\n            this.setImageByBuffer(gl, null, o);\r\n        } else {\r\n            //No image or buffer exists. so we set texture to pink black checkerboard\r\n            //This should probably happen at the material loading level and not during texture setting\r\n            const o2 = {\r\n                ...DefaultTextureOptions,\r\n                ...{\r\n                    width: 8,\r\n                    height: 8,\r\n                    wrap_S: gl.REPEAT,\r\n                    wrap_T: gl.MIRRORED_REPEAT,\r\n                    mag_filter: gl.NEAREST,\r\n                    min_filter: gl.NEAREST,\r\n                },\r\n            };\r\n            this.setImageByBuffer(gl, TextureHelper.PINK_BLACK_CHECKERBOARD, o2);\r\n        }\r\n    }\r\n\r\n    public bind(gl: WebGL2RenderingContext, location: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + location);\r\n        gl.bindTexture(gl.TEXTURE_2D, this.texture_id);\r\n    }\r\n\r\n    public setImage(gl: WebGL2RenderingContext, image: TexImageSource, options?: Partial<TextureOptions>): void {\r\n        const o: TextureOptions = { ...DefaultTextureOptions, ...options };\r\n        gl.bindTexture(gl.TEXTURE_2D, this.texture_id);\r\n        //prettier-ignore\r\n        TextureHelper.texParameterImage(gl, gl.TEXTURE_2D, image, o);\r\n    }\r\n\r\n    public setImageByBuffer(\r\n        gl: WebGL2RenderingContext,\r\n        buffer: ArrayBufferView | null,\r\n        options?: Partial<TextureOptions>\r\n    ): void {\r\n        const o: TextureOptions = { ...DefaultTextureOptions, ...options };\r\n        gl.bindTexture(gl.TEXTURE_2D, this.texture_id);\r\n        //prettier-ignore\r\n        TextureHelper.texParameterBuffer(gl, gl.TEXTURE_2D, buffer, o);\r\n    }\r\n\r\n    public destroy(gl: WebGL2RenderingContext): void {\r\n        gl.deleteTexture(this.texture_id);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}