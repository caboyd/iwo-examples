{"version":3,"file":"TextureHelper.js","sources":["../../../../iwo/src/graphics/TextureHelper.ts"],"sourcesContent":["/**\r\n * Created by Chris on May, 2019\r\n */\r\n\r\ntype TextureType =\r\n    | WebGL2RenderingContext[\"TEXTURE_2D\"]\r\n    | WebGL2RenderingContext[\"TEXTURE_CUBE_MAP\"]\r\n    | WebGL2RenderingContext[\"TEXTURE_3D\"]\r\n    | WebGL2RenderingContext[\"TEXTURE_2D_ARRAY\"];\r\n\r\nexport namespace TextureHelper {\r\n    export function texParameterBuffer(\r\n        gl: WebGL2RenderingContext,\r\n        texture_type: TextureType,\r\n        buffer: ArrayBufferView | null,\r\n        width: number,\r\n        height: number,\r\n        wrap_S: number,\r\n        wrap_T: number,\r\n        wrap_R: number | undefined,\r\n        mag_filter: number,\r\n        min_filter: number,\r\n        internal_format: number,\r\n        format: number,\r\n        type: number,\r\n        flip: boolean\r\n    ): void {\r\n        texParamHelperStart(gl, min_filter, format, flip);\r\n\r\n        if (texture_type == gl.TEXTURE_CUBE_MAP) {\r\n            for (let i = 0; i < 6; i++) {\r\n                // note that we store each face with 16 bit floating point values\r\n                //prettier-ignore\r\n                gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, internal_format, width, height,\r\n                    0, format, type, buffer);\r\n            }\r\n        } else if (texture_type == gl.TEXTURE_2D) {\r\n            gl.texImage2D(texture_type, 0, internal_format, width, height, 0, format, type, buffer);\r\n        } else {\r\n            throw new Error(`texture type ${texture_type} not supported.`);\r\n        }\r\n\r\n        texParamHelperEnd(gl, texture_type, wrap_S, wrap_T, wrap_R, mag_filter, min_filter);\r\n    }\r\n\r\n    export function texParameterImage(\r\n        gl: WebGL2RenderingContext,\r\n        texture_type: TextureType,\r\n        image: TexImageSource,\r\n        wrap_S: number,\r\n        wrap_T: number,\r\n        wrap_R: number | undefined,\r\n        mag_filter: number,\r\n        min_filter: number,\r\n        internal_format: number,\r\n        format: number,\r\n        type: number,\r\n        flip: boolean\r\n    ): void {\r\n        texParamHelperStart(gl, min_filter, format, flip);\r\n        if (texture_type == gl.TEXTURE_CUBE_MAP) {\r\n            for (let i = 0; i < 6; i++) {\r\n                // note that we store each face with 16 bit floating point values\r\n                //prettier-ignore\r\n                gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, internal_format, format, type,\r\n                    image as ImageData);\r\n            }\r\n        } else if (texture_type == gl.TEXTURE_2D) {\r\n            gl.texImage2D(texture_type, 0, internal_format, format, type, image as ImageData);\r\n        } else {\r\n            throw new Error(`texture type ${texture_type} not supported.`);\r\n        }\r\n\r\n        texParamHelperEnd(gl, texture_type, wrap_S, wrap_T, wrap_R, mag_filter, min_filter);\r\n    }\r\n\r\n    function texParamHelperStart(gl: WebGL2RenderingContext, min_filter: number, format: number, flip: boolean): void {\r\n        const ext = gl.getExtension(\"OES_texture_float_linear\");\r\n        //Assert float linear supported if using float textures with linear filtering\r\n        //one of gl.LINEAR, gl.LINEAR_MIPMAP_NEAREST, gl.NEAREST_MIPMAP_LINEAR, or gl.LINEAR_MIPMAP_LINEAR\r\n        if (\r\n            !ext &&\r\n            (format == gl.FLOAT || format == gl.HALF_FLOAT) &&\r\n            min_filter != gl.NEAREST &&\r\n            min_filter != gl.NEAREST_MIPMAP_NEAREST\r\n        )\r\n            throw new Error(\"TextureCubeMap loadBuffer failed. OES_texture_float_linear not available.\");\r\n\r\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flip);\r\n    }\r\n\r\n    function texParamHelperEnd(\r\n        gl: WebGL2RenderingContext,\r\n        texture_type: TextureType,\r\n        wrap_S: number,\r\n        wrap_T: number,\r\n        wrap_R: number | undefined,\r\n        mag_filter: number,\r\n        min_filter: number\r\n    ): void {\r\n        gl.texParameteri(texture_type, gl.TEXTURE_WRAP_S, wrap_S);\r\n        gl.texParameteri(texture_type, gl.TEXTURE_WRAP_T, wrap_T);\r\n        if (wrap_R) gl.texParameteri(texture_type, gl.TEXTURE_WRAP_R, wrap_R);\r\n        gl.texParameteri(texture_type, gl.TEXTURE_MAG_FILTER, mag_filter);\r\n        gl.texParameteri(texture_type, gl.TEXTURE_MIN_FILTER, min_filter);\r\n        if (\r\n            min_filter == gl.LINEAR_MIPMAP_LINEAR ||\r\n            min_filter == gl.LINEAR_MIPMAP_NEAREST ||\r\n            min_filter == gl.NEAREST_MIPMAP_LINEAR ||\r\n            min_filter == gl.NEAREST_MIPMAP_NEAREST\r\n        )\r\n            gl.generateMipmap(texture_type);\r\n    }\r\n\r\n    export function isArrayBufferView(value: any): boolean {\r\n        return value && value.buffer instanceof ArrayBuffer && value.byteLength !== undefined;\r\n    }\r\n\r\n    const arr = [];\r\n    for (let i = 0; i < 8; i++) {\r\n        for (let j = 0; j < 4; j++) {\r\n            if (i & 1)\r\n                //prettier-ignore\r\n                arr.push(\r\n                    0, 0, 0, 255, // black\r\n                    255, 0, 255, 255 //pink\r\n                );\r\n            else\r\n                //prettier-ignore\r\n                arr.push(\r\n                    255, 0, 255, 255, //pink\r\n                    0, 0, 0, 255 // black\r\n                );\r\n        }\r\n    }\r\n    export const PINK_BLACK_CHECKERBOARD = new Uint8Array(arr);\r\n}\r\n"],"names":[],"mappings":"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"}