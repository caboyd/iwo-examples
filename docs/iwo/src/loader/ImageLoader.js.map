{"version":3,"file":"ImageLoader.js","sources":["../../../../iwo/src/loader/ImageLoader.ts"],"sourcesContent":["import { FileLoader } from \"./FileLoader\";\r\n\r\nexport class ImageLoader extends FileLoader {\r\n    public static async promise(\r\n        file_name: string,\r\n        base_url: string = window.location.href.substr(0, window.location.href.lastIndexOf(\"/\"))\r\n    ): Promise<HTMLImageElement> {\r\n        return new Promise<HTMLImageElement>((resolve, reject) => {\r\n            super.promise(file_name, base_url).then((response: Response) => {\r\n                response.blob().then((data: Blob) => {\r\n                    const img = new Image();\r\n                    const clear = (): null => (img.onload = img.onerror = null);\r\n                    img.src = URL.createObjectURL(data);\r\n                    img.onload = (): void => {\r\n                        clear();\r\n                        resolve(img);\r\n                    };\r\n                    img.onerror = (e): void => {\r\n                        clear();\r\n                        reject(e);\r\n                    };\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    public static async promiseAll(\r\n        files: string[],\r\n        base_url: string = window.location.href.substr(0, window.location.href.lastIndexOf(\"/\"))\r\n    ): Promise<HTMLImageElement[]> {\r\n        const imgs = Array.from({ length: files.length }, u => new Image());\r\n        const promises: Promise<HTMLImageElement>[] = [];\r\n\r\n        return super.promiseAll(files, base_url).then((responses: Response[] | any) => {\r\n            for (let i = 0; i < responses.length; i++) {\r\n                const img = imgs[i];\r\n                const clear = (): null => (img.onload = img.onerror = null);\r\n                const promise = new Promise<HTMLImageElement>((resolve, reject) => {\r\n                    responses[i].blob().then((data: Blob) => {\r\n                        img.src = URL.createObjectURL(data);\r\n                        img.onload = (): void => {\r\n                            clear();\r\n                            resolve(img);\r\n                        };\r\n                        img.onerror = (e): void => {\r\n                            clear();\r\n                            reject(e);\r\n                        };\r\n                    });\r\n                });\r\n                promises.push(promise);\r\n            }\r\n            return Promise.all(promises);\r\n        });\r\n    }\r\n\r\n    public static load(file_name: string, base_url: string = \"\"): HTMLImageElement {\r\n        const img = new Image();\r\n        super.promise(file_name, base_url).then(data => {\r\n            img.src = URL.createObjectURL(data);\r\n        });\r\n        return img;\r\n    }\r\n}\r\n"],"names":["FileLoader"],"mappings":"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"}