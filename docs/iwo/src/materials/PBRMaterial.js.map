{"version":3,"file":"PBRMaterial.js","sources":["../../../../iwo/src/materials/PBRMaterial.ts"],"sourcesContent":["import { Material } from \"./Material\";\r\nimport { Shader } from \"graphics/shader/Shader\";\r\nimport { Renderer } from \"graphics/Renderer\";\r\nimport { Texture2D } from \"graphics/Texture2D\";\r\nimport { vec3 } from \"gl-matrix\";\r\nimport { TextureCubeMap } from \"graphics/TextureCubeMap\";\r\n\r\nexport class PBRMaterial extends Material {\r\n    public albedo: vec3;\r\n    public metallic: number;\r\n    public roughness: number;\r\n    public ao: number;\r\n    public albedo_texture: Texture2D | undefined;\r\n    public irradiance_texture: TextureCubeMap | undefined;\r\n    public specular_env: TextureCubeMap | undefined;\r\n\r\n    public constructor(color: vec3, metallic: number, roughness: number, ambient_occlusion: number = 1.0) {\r\n        super();\r\n\r\n        this.albedo = vec3.clone(color);\r\n        this.metallic = metallic;\r\n        this.roughness = roughness;\r\n        this.ao = ambient_occlusion;\r\n    }\r\n\r\n    public activate(gl: WebGL2RenderingContext): void {\r\n        const shader = this.shader;\r\n        const active_textures = [false, false, false];\r\n        if (this.albedo_texture) {\r\n            this.albedo_texture.bind(gl, 0);\r\n            active_textures[0] = true;\r\n        }\r\n\r\n        if (this.irradiance_texture) {\r\n            this.irradiance_texture.bind(gl, 1);\r\n            active_textures[1] = true;\r\n        }\r\n\r\n        if (this.specular_env) {\r\n            this.specular_env.bind(gl, 2);\r\n            active_textures[2] = true;\r\n        }\r\n\r\n        if (Renderer.BRDF_LUT_TEXTURE) {\r\n            gl.activeTexture(gl.TEXTURE3);\r\n            gl.bindTexture(gl.TEXTURE_2D, Renderer.BRDF_LUT_TEXTURE);\r\n        }\r\n\r\n        shader.setUniform(\"u_material.active_textures[0]\", active_textures);\r\n        shader.setUniform(\"u_material.albedo\", this.albedo);\r\n        shader.setUniform(\"u_material.roughness\", this.roughness);\r\n        shader.setUniform(\"u_material.metallic\", this.metallic);\r\n        shader.setUniform(\"u_material.ao\", this.ao);\r\n    }\r\n\r\n    public get shader(): Shader {\r\n        return Renderer.GetShader(\"PBRShader\")!;\r\n    }\r\n\r\n    public static get Shader(): Shader {\r\n        return Renderer.GetShader(\"PBRShader\")!;\r\n    }\r\n\r\n    private static generateBRDFLUT(gl: WebGL2RenderingContext): Texture2D {\r\n        const tex = {} as Texture2D;\r\n        tex.texture_id = gl.createTexture()!;\r\n\r\n        return tex;\r\n    }\r\n}\r\n"],"names":["Material","Renderer"],"mappings":";;;;MAOa,WAAY,SAAQA,UAAQ;IASrC,YAAmB,KAAW,EAAE,QAAgB,EAAE,SAAiB,EAAE,oBAA4B,GAAG;QAChG,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAChC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,EAAE,GAAG,iBAAiB,CAAC;KAC/B;IAEM,QAAQ,CAAC,EAA0B;QACtC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC3B,MAAM,eAAe,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;QAC9C,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAChC,eAAe,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;SAC7B;QAED,IAAI,IAAI,CAAC,kBAAkB,EAAE;YACzB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YACpC,eAAe,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;SAC7B;QAED,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAC9B,eAAe,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;SAC7B;QAED,IAAIC,UAAQ,CAAC,gBAAgB,EAAE;YAC3B,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;YAC9B,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAEA,UAAQ,CAAC,gBAAgB,CAAC,CAAC;SAC5D;QAED,MAAM,CAAC,UAAU,CAAC,+BAA+B,EAAE,eAAe,CAAC,CAAC;QACpE,MAAM,CAAC,UAAU,CAAC,mBAAmB,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACpD,MAAM,CAAC,UAAU,CAAC,sBAAsB,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QAC1D,MAAM,CAAC,UAAU,CAAC,qBAAqB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QACxD,MAAM,CAAC,UAAU,CAAC,eAAe,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;KAC/C;IAED,IAAW,MAAM;QACb,OAAOA,UAAQ,CAAC,SAAS,CAAC,WAAW,CAAE,CAAC;KAC3C;IAEM,WAAW,MAAM;QACpB,OAAOA,UAAQ,CAAC,SAAS,CAAC,WAAW,CAAE,CAAC;KAC3C;IAEO,OAAO,eAAe,CAAC,EAA0B;QACrD,MAAM,GAAG,GAAG,EAAe,CAAC;QAC5B,GAAG,CAAC,UAAU,GAAG,EAAE,CAAC,aAAa,EAAG,CAAC;QAErC,OAAO,GAAG,CAAC;KACd;;;;;"}