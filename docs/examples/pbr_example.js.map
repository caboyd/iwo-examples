{"version":3,"file":"pbr_example.js","sources":["../../examples/pbr_example.ts"],"sourcesContent":["import { glMatrix, mat4, vec3 } from \"gl-matrix\";\r\nimport { Camera, Camera_Movement } from \"cameras/Camera\";\r\nimport { BoxGeometry } from \"geometry/BoxGeometry\";\r\nimport { Mesh } from \"meshes/Mesh\";\r\nimport { MeshInstance } from \"meshes/MeshInstance\";\r\nimport { Renderer } from \"graphics/Renderer\";\r\nimport { FileLoader } from \"loader/FileLoader\";\r\nimport { SphereGeometry } from \"geometry/SphereGeometry\";\r\nimport { PlaneGeometry } from \"geometry/PlaneGeometry\";\r\nimport { GridMaterial } from \"materials/GridMaterial\";\r\nimport { PBRMaterial } from \"materials/PBRMaterial\";\r\nimport { BasicMaterial } from \"materials/BasicMaterial\";\r\nimport { ImageLoader } from \"loader/ImageLoader\";\r\nimport { Texture2D } from \"graphics/Texture2D\";\r\nimport { HDRBuffer, HDRImageLoader } from \"loader/HDRImageLoader\";\r\nimport { TextureCubeMap } from \"graphics/TextureCubeMap\";\r\nimport { TextureLoader } from \"loader/TextureLoader\";\r\n\r\nlet canvas: HTMLCanvasElement;\r\n\r\nlet gl: WebGL2RenderingContext;\r\n\r\nconst view_matrix: mat4 = mat4.create();\r\nconst proj_matrix: mat4 = mat4.create();\r\n\r\nconst cPos: vec3 = vec3.fromValues(0.5, 8, 9.0);\r\nconst cUp: vec3 = vec3.fromValues(0, 1, 0);\r\nconst cFront: vec3 = vec3.fromValues(0, 0, -1);\r\n\r\nconst light_color: vec3 = vec3.fromValues(12.47, 12.31, 12.79);\r\nconst light_positions: [number, number, number, number][] = [\r\n    [10, 15, 10, 1],\r\n    [-10, 5, 10, 1],\r\n    [0, 5, -10, 1],\r\n];\r\n\r\nlet camera: Camera;\r\n\r\nlet mouse_x_total = 0;\r\nlet mouse_y_total = 0;\r\nconst keys: Array<boolean> = [];\r\n\r\nlet box: MeshInstance;\r\nlet light_boxes: MeshInstance[];\r\nlet skybox: MeshInstance;\r\nlet spheres: MeshInstance[];\r\nlet sphere_mat: PBRMaterial;\r\nlet grid: MeshInstance;\r\nlet renderer: Renderer;\r\n\r\n//document.getElementById(\"loading-text-wrapper\")!.remove();\r\n\r\nconst moveCallback = (e: MouseEvent): void => {\r\n    const movementX = e.movementX || 0;\r\n    const movementY = e.movementY || 0;\r\n    if (e.which == 1) {\r\n        mouse_x_total += movementX;\r\n        mouse_y_total += movementY;\r\n    }\r\n};\r\n\r\nconst stats = (): void => {\r\n    const script = document.createElement(\"script\");\r\n    script.onload = (): void => {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        //@ts-ignore\r\n        const stats = new Stats();\r\n        document.body.appendChild(stats.dom);\r\n        requestAnimationFrame(function loop() {\r\n            stats.update();\r\n            requestAnimationFrame(loop);\r\n        });\r\n    };\r\n    script.src = \"//rawgit.com/mrdoob/stats.js/master/build/stats.min.js\";\r\n    document.head.appendChild(script);\r\n};\r\n\r\n(function main(): void {\r\n    stats();\r\n\r\n    canvas = <HTMLCanvasElement>document.getElementById(\"canvas\");\r\n    document.addEventListener(\"mousemove\", moveCallback, false);\r\n\r\n    gl = initGL();\r\n\r\n    renderer = new Renderer(gl);\r\n\r\n    window.addEventListener(\"resize\", resizeCanvas, false);\r\n\r\n    function resizeCanvas(): void {\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n        renderer.setViewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n        mat4.perspective(\r\n            proj_matrix,\r\n            glMatrix.toRadian(90),\r\n            gl.drawingBufferWidth / gl.drawingBufferHeight,\r\n            0.1,\r\n            1000.0\r\n        );\r\n    }\r\n\r\n    resizeCanvas();\r\n\r\n    camera = new Camera(cPos, cFront, cUp);\r\n\r\n    gl.clearColor(0.2, 0.3, 0.3, 1.0);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.cullFace(gl.BACK);\r\n\r\n    renderer.setViewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    mat4.perspective(proj_matrix, glMatrix.toRadian(90), gl.drawingBufferWidth / gl.drawingBufferHeight, 0.1, 1000.0);\r\n\r\n    //0.5-u because we scaled x by -1 to invert sphere\r\n    //1-v because we flipped the image\r\n    const sun_dir = sphereUVtoVec3(vec3.create(), 0.5 + 0.872, 1 - 0.456);\r\n    const sun_intensity = 24;\r\n    const sun_color = [(sun_intensity * 254) / 255, (sun_intensity * 238) / 255, (sun_intensity * 224) / 255];\r\n\r\n    const pbrShader = PBRMaterial.Shader;\r\n    pbrShader.use();\r\n    pbrShader.setUniform(\"u_lights[0].position\", [sun_dir[0], sun_dir[1], sun_dir[2], 0]);\r\n    pbrShader.setUniform(\"u_lights[0].color\", sun_color);\r\n\r\n    pbrShader.setUniform(\"u_lights[1].position\", light_positions[0]);\r\n    pbrShader.setUniform(\"u_lights[1].color\", light_color);\r\n\r\n    pbrShader.setUniform(\"u_lights[2].position\", light_positions[1]);\r\n    pbrShader.setUniform(\"u_lights[2].color\", light_color);\r\n\r\n    pbrShader.setUniform(\"u_lights[3].position\", light_positions[2]);\r\n    pbrShader.setUniform(\"u_lights[3].color\", light_color);\r\n\r\n    pbrShader.setUniform(\"u_light_count\", 4);\r\n\r\n    initScene();\r\n\r\n    requestAnimationFrame(update);\r\n})();\r\n\r\nfunction initGL(): WebGL2RenderingContext {\r\n    try {\r\n        gl = <WebGL2RenderingContext>canvas.getContext(\"webgl2\");\r\n    } catch (e) {\r\n        throw new Error(\"GL init error:\\n\" + e);\r\n    }\r\n\r\n    if (!gl) {\r\n        alert(\"WebGL is not available on your browser.\");\r\n    }\r\n    return gl;\r\n}\r\n\r\nfunction initScene(): void {\r\n    let global_root = window.location.href.substr(0, window.location.href.lastIndexOf(\"/\"));\r\n    //Removes /examples subfolder off end of url so images are found in correct folder\r\n    global_root = global_root.substring(0, global_root.lastIndexOf(\"/\") + 1);\r\n\r\n    const sky_tex = new Texture2D(gl);\r\n    let irr_tex = new TextureCubeMap(gl);\r\n    let env_tex = new TextureCubeMap(gl);\r\n    const cube_tex = new TextureCubeMap(gl);\r\n\r\n    const tex2D_opts = {\r\n        wrap_S: gl.CLAMP_TO_EDGE,\r\n        wrap_T: gl.CLAMP_TO_EDGE,\r\n        mag_filter: gl.LINEAR,\r\n        min_filter: gl.LINEAR,\r\n        flip: true,\r\n    };\r\n\r\n    const file_prefix = \"../assets/cubemap/monvalley/MonValley_A_LookoutPoint\";\r\n    ImageLoader.promise(file_prefix + \"_preview.jpg\").then((image: HTMLImageElement) => {\r\n        sky_tex.setImage(gl, image, tex2D_opts);\r\n        ImageLoader.promise(file_prefix + \"_8k.jpg\").then((image: HTMLImageElement) => {\r\n            sky_tex.setImage(gl, image, tex2D_opts);\r\n        });\r\n    });\r\n\r\n    HDRImageLoader.promise(file_prefix + \"_Env.hdr\").then((data: HDRBuffer) => {\r\n        cube_tex.setEquirectangularHDRBuffer(renderer, data);\r\n        irr_tex = TextureCubeMap.irradianceFromCubemap(irr_tex, renderer, cube_tex);\r\n        env_tex = TextureCubeMap.specularFromCubemap(env_tex, renderer, cube_tex);\r\n        HDRImageLoader.promise(file_prefix + \"_2k.hdr\").then((data: HDRBuffer) => {\r\n            cube_tex.setEquirectangularHDRBuffer(renderer, data);\r\n            env_tex = TextureCubeMap.specularFromCubemap(env_tex, renderer, cube_tex, data.width);\r\n            cube_tex.destroy(gl);\r\n        });\r\n    });\r\n\r\n    const earth_tex = TextureLoader.load(gl, \"../assets/earth.jpg\");\r\n\r\n    const box_geom = new BoxGeometry(3.0, 3.0, 3.0, 1, 1, 1, false);\r\n    const sphere_geom = new SphereGeometry(0.75, 16, 16);\r\n    const plane_geom = new PlaneGeometry(100, 100, 1, 1, true);\r\n\r\n    const sphere_mesh = new Mesh(gl, sphere_geom);\r\n    const plane_mesh = new Mesh(gl, plane_geom);\r\n    const box_mesh = new Mesh(gl, box_geom);\r\n\r\n    sphere_mat = new PBRMaterial(vec3.fromValues(1, 0, 0), 0.0, 0.0);\r\n    sphere_mat.albedo_texture = earth_tex;\r\n\r\n    //GRID\r\n    const grid_mat = new GridMaterial(50);\r\n    grid = new MeshInstance(plane_mesh, grid_mat);\r\n\r\n    //SKYBOX\r\n    const sky_geom = new SphereGeometry(1, 48, 48);\r\n    const sky_mesh = new Mesh(gl, sky_geom);\r\n    const sky_mat = new BasicMaterial([1, 1, 1]);\r\n    sky_mat.setAlbedoTexture(sky_tex);\r\n    skybox = new MeshInstance(sky_mesh, sky_mat);\r\n\r\n    //LIGHTS\r\n    const light_geom = new BoxGeometry(1.0, 1.0, 1.0);\r\n    const light_mesh = new Mesh(gl, light_geom);\r\n    const light_mat = new PBRMaterial(vec3.fromValues(1000, 1000, 1000), 0.0, 1.0);\r\n    light_boxes = [];\r\n    for (const pos of light_positions) {\r\n        const lb = new MeshInstance(light_mesh, light_mat);\r\n        mat4.translate(lb.model_matrix, lb.model_matrix, [pos[0], pos[1], pos[2]]);\r\n        light_boxes.push(lb);\r\n    }\r\n\r\n    //BOX\r\n    const box_mat = new BasicMaterial(vec3.fromValues(1, 1, 1));\r\n    //box_mat.setAlbedoTexture(env_tex, true);\r\n    box_mat.setAlbedoCubeTexture(cube_tex);\r\n    box = new MeshInstance(box_mesh, box_mat);\r\n    mat4.translate(box.model_matrix, box.model_matrix, vec3.fromValues(-2, 5, 3));\r\n\r\n    //SPHERES\r\n\r\n    spheres = [];\r\n    const num_cols = 8;\r\n    const num_rows = 8;\r\n    for (let i = 0; i <= num_cols; i++) {\r\n        for (let k = 0; k <= num_rows; k++) {\r\n            const mat = new PBRMaterial([1, 1, 1], k / num_rows, Math.min(1, Math.max(0.025, i / num_cols)), 1);\r\n            mat.albedo_texture = sphere_mat.albedo_texture;\r\n            mat.irradiance_texture = irr_tex;\r\n            mat.specular_env = env_tex;\r\n            const s = new MeshInstance(sphere_mesh, mat);\r\n            spheres.push(s);\r\n\r\n            const model = s.model_matrix;\r\n            mat4.identity(model);\r\n            mat4.translate(model, model, vec3.fromValues((i - num_cols / 2) * 2, k * 2, 0));\r\n            //  mat4.rotateY(model, model, glMatrix.toRadian(Date.now() * -0.08));\r\n            //   mat4.rotateZ(model, model, glMatrix.toRadian(Date.now() * 0.06));\r\n        }\r\n    }\r\n}\r\n\r\nfunction update(): void {\r\n    if (keys[87]) camera.processKeyboard(Camera_Movement.FORWARD, 0.001);\r\n    else if (keys[83]) camera.processKeyboard(Camera_Movement.BACKWARD, 0.001);\r\n    if (keys[65]) camera.processKeyboard(Camera_Movement.LEFT, 0.001);\r\n    else if (keys[68]) camera.processKeyboard(Camera_Movement.RIGHT, 0.001);\r\n    if (keys[82]) camera.lookAt(vec3.fromValues(0, 0, 0));\r\n    if (keys[32]) camera.processKeyboard(Camera_Movement.UP, 0.001);\r\n\r\n    camera.processMouseMovement(-mouse_x_total, -mouse_y_total, true);\r\n    mouse_x_total = 0;\r\n    mouse_y_total = 0;\r\n\r\n    drawScene();\r\n    requestAnimationFrame(update);\r\n}\r\n\r\nfunction drawScene(): void {\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n    camera.getViewMatrix(view_matrix);\r\n\r\n    renderer.setPerFrameUniforms(view_matrix, proj_matrix);\r\n\r\n    //skybox\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.CULL_FACE);\r\n    mat4.identity(skybox.model_matrix);\r\n    mat4.translate(skybox.model_matrix, skybox.model_matrix, camera.position);\r\n    mat4.scale(skybox.model_matrix, skybox.model_matrix, [-1, 1, -1]);\r\n\r\n    skybox.render(renderer, view_matrix, proj_matrix);\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.enable(gl.DEPTH_TEST);\r\n\r\n    //mat4.rotateY(box.model_matrix, box.model_matrix, glMatrix.toRadian(0.7));\r\n    //mat4.rotateZ(box.model_matrix, box.model_matrix, glMatrix.toRadian(0.5));\r\n\r\n    //  box.render(renderer, view_matrix, proj_matrix);\r\n\r\n    for (const lb of light_boxes) lb.render(renderer, view_matrix, proj_matrix);\r\n\r\n    for (const sphere of spheres) {\r\n        sphere.render(renderer, view_matrix, proj_matrix);\r\n    }\r\n\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    grid.render(renderer, view_matrix, proj_matrix);\r\n\r\n    gl.disable(gl.BLEND);\r\n}\r\n\r\nwindow.onkeydown = function(e: KeyboardEvent): void {\r\n    keys[e.keyCode] = true;\r\n};\r\n\r\nwindow.onkeyup = function(e: KeyboardEvent): void {\r\n    keys[e.keyCode] = false;\r\n};\r\n\r\n/*\r\n    Converts UV coords of equirectangular image to the vector direction,\r\n    as if it was projected onto the sphere\r\n */\r\nfunction sphereUVtoVec3(out: vec3, u: number, v: number): vec3 {\r\n    const theta = (v - 0.5) * Math.PI;\r\n    const phi = u * 2 * Math.PI;\r\n\r\n    const x = Math.cos(phi) * Math.cos(theta);\r\n    const y = Math.sin(theta);\r\n    const z = Math.sin(phi) * Math.cos(theta);\r\n\r\n    vec3.set(out, x, y, z);\r\n    return out;\r\n}\r\n"],"names":["Renderer","Camera","PBRMaterial","Texture2D","TextureCubeMap","ImageLoader","HDRImageLoader","TextureLoader","BoxGeometry","SphereGeometry","PlaneGeometry","Mesh","GridMaterial","MeshInstance","BasicMaterial"],"mappings":";;;;;;;;;;;;;;;;;AAkBA,IAAI,MAAyB,CAAC;AAE9B,IAAI,EAA0B,CAAC;AAE/B,MAAM,WAAW,GAAS,IAAI,CAAC,MAAM,EAAE,CAAC;AACxC,MAAM,WAAW,GAAS,IAAI,CAAC,MAAM,EAAE,CAAC;AAExC,MAAM,IAAI,GAAS,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;AAChD,MAAM,GAAG,GAAS,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAC3C,MAAM,MAAM,GAAS,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAE/C,MAAM,WAAW,GAAS,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;AAC/D,MAAM,eAAe,GAAuC;IACxD,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IACf,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IACf,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;CACjB,CAAC;AAEF,IAAI,MAAc,CAAC;AAEnB,IAAI,aAAa,GAAG,CAAC,CAAC;AACtB,IAAI,aAAa,GAAG,CAAC,CAAC;AACtB,MAAM,IAAI,GAAmB,EAAE,CAAC;AAEhC,IAAI,GAAiB,CAAC;AACtB,IAAI,WAA2B,CAAC;AAChC,IAAI,MAAoB,CAAC;AACzB,IAAI,OAAuB,CAAC;AAC5B,IAAI,UAAuB,CAAC;AAC5B,IAAI,IAAkB,CAAC;AACvB,IAAI,QAAkB,CAAC;AAEvB;AAEA,MAAM,YAAY,GAAG,CAAC,CAAa;IAC/B,MAAM,SAAS,GAAG,CAAC,CAAC,SAAS,IAAI,CAAC,CAAC;IACnC,MAAM,SAAS,GAAG,CAAC,CAAC,SAAS,IAAI,CAAC,CAAC;IACnC,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,EAAE;QACd,aAAa,IAAI,SAAS,CAAC;QAC3B,aAAa,IAAI,SAAS,CAAC;KAC9B;AACL,CAAC,CAAC;AAEF,MAAM,KAAK,GAAG;IACV,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAChD,MAAM,CAAC,MAAM,GAAG;;;QAGZ,MAAM,KAAK,GAAG,IAAI,KAAK,EAAE,CAAC;QAC1B,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrC,qBAAqB,CAAC,SAAS,IAAI;YAC/B,KAAK,CAAC,MAAM,EAAE,CAAC;YACf,qBAAqB,CAAC,IAAI,CAAC,CAAC;SAC/B,CAAC,CAAC;KACN,CAAC;IACF,MAAM,CAAC,GAAG,GAAG,wDAAwD,CAAC;IACtE,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AACtC,CAAC,CAAC;AAEF,CAAC,SAAS,IAAI;IACV,KAAK,EAAE,CAAC;IAER,MAAM,GAAsB,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IAC9D,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,YAAY,EAAE,KAAK,CAAC,CAAC;IAE5D,EAAE,GAAG,MAAM,EAAE,CAAC;IAEd,QAAQ,GAAG,IAAIA,UAAQ,CAAC,EAAE,CAAC,CAAC;IAE5B,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,YAAY,EAAE,KAAK,CAAC,CAAC;IAEvD,SAAS,YAAY;QACjB,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC;QACjC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC;QACnC,QAAQ,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,kBAAkB,EAAE,EAAE,CAAC,mBAAmB,CAAC,CAAC;QAC1E,IAAI,CAAC,WAAW,CACZ,WAAW,EACX,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,EACrB,EAAE,CAAC,kBAAkB,GAAG,EAAE,CAAC,mBAAmB,EAC9C,GAAG,EACH,MAAM,CACT,CAAC;KACL;IAED,YAAY,EAAE,CAAC;IAEf,MAAM,GAAG,IAAIC,QAAM,CAAC,IAAI,EAAE,MAAM,EAAE,GAAG,CAAC,CAAC;IAEvC,EAAE,CAAC,UAAU,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAClC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;IACzB,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;IACxB,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;IAErB,QAAQ,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,kBAAkB,EAAE,EAAE,CAAC,mBAAmB,CAAC,CAAC;IAC1E,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,kBAAkB,GAAG,EAAE,CAAC,mBAAmB,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC;;;IAIlH,MAAM,OAAO,GAAG,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,KAAK,CAAC,CAAC;IACtE,MAAM,aAAa,GAAG,EAAE,CAAC;IACzB,MAAM,SAAS,GAAG,CAAC,CAAC,aAAa,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC,aAAa,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC,aAAa,GAAG,GAAG,IAAI,GAAG,CAAC,CAAC;IAE1G,MAAM,SAAS,GAAGC,aAAW,CAAC,MAAM,CAAC;IACrC,SAAS,CAAC,GAAG,EAAE,CAAC;IAChB,SAAS,CAAC,UAAU,CAAC,sBAAsB,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACtF,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,SAAS,CAAC,CAAC;IAErD,SAAS,CAAC,UAAU,CAAC,sBAAsB,EAAE,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC;IAEvD,SAAS,CAAC,UAAU,CAAC,sBAAsB,EAAE,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC;IAEvD,SAAS,CAAC,UAAU,CAAC,sBAAsB,EAAE,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC;IAEvD,SAAS,CAAC,UAAU,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;IAEzC,SAAS,EAAE,CAAC;IAEZ,qBAAqB,CAAC,MAAM,CAAC,CAAC;AAClC,CAAC,GAAG,CAAC;AAEL,SAAS,MAAM;IACX,IAAI;QACA,EAAE,GAA2B,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;KAC5D;IAAC,OAAO,CAAC,EAAE;QACR,MAAM,IAAI,KAAK,CAAC,kBAAkB,GAAG,CAAC,CAAC,CAAC;KAC3C;IAED,IAAI,CAAC,EAAE,EAAE;QACL,KAAK,CAAC,yCAAyC,CAAC,CAAC;KACpD;IACD,OAAO,EAAE,CAAC;AACd,CAAC;AAED,SAAS,SAAS;IACd,IAAI,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;;IAExF,WAAW,GAAG,WAAW,CAAC,SAAS,CAAC,CAAC,EAAE,WAAW,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;IAEzE,MAAM,OAAO,GAAG,IAAIC,WAAS,CAAC,EAAE,CAAC,CAAC;IAClC,IAAI,OAAO,GAAG,IAAIC,gBAAc,CAAC,EAAE,CAAC,CAAC;IACrC,IAAI,OAAO,GAAG,IAAIA,gBAAc,CAAC,EAAE,CAAC,CAAC;IACrC,MAAM,QAAQ,GAAG,IAAIA,gBAAc,CAAC,EAAE,CAAC,CAAC;IAExC,MAAM,UAAU,GAAG;QACf,MAAM,EAAE,EAAE,CAAC,aAAa;QACxB,MAAM,EAAE,EAAE,CAAC,aAAa;QACxB,UAAU,EAAE,EAAE,CAAC,MAAM;QACrB,UAAU,EAAE,EAAE,CAAC,MAAM;QACrB,IAAI,EAAE,IAAI;KACb,CAAC;IAEF,MAAM,WAAW,GAAG,sDAAsD,CAAC;IAC3EC,aAAW,CAAC,OAAO,CAAC,WAAW,GAAG,cAAc,CAAC,CAAC,IAAI,CAAC,CAAC,KAAuB;QAC3E,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;QACxCA,aAAW,CAAC,OAAO,CAAC,WAAW,GAAG,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,KAAuB;YACtE,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;SAC3C,CAAC,CAAC;KACN,CAAC,CAAC;IAEHC,gBAAc,CAAC,OAAO,CAAC,WAAW,GAAG,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,IAAe;QAClE,QAAQ,CAAC,2BAA2B,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACrD,OAAO,GAAGF,gBAAc,CAAC,qBAAqB,CAAC,OAAO,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC5E,OAAO,GAAGA,gBAAc,CAAC,mBAAmB,CAAC,OAAO,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC1EE,gBAAc,CAAC,OAAO,CAAC,WAAW,GAAG,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,IAAe;YACjE,QAAQ,CAAC,2BAA2B,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;YACrD,OAAO,GAAGF,gBAAc,CAAC,mBAAmB,CAAC,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;YACtF,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;SACxB,CAAC,CAAC;KACN,CAAC,CAAC;IAEH,MAAM,SAAS,GAAGG,eAAa,CAAC,IAAI,CAAC,EAAE,EAAE,qBAAqB,CAAC,CAAC;IAEhE,MAAM,QAAQ,GAAG,IAAIC,aAAW,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC;IAChE,MAAM,WAAW,GAAG,IAAIC,gBAAc,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IACrD,MAAM,UAAU,GAAG,IAAIC,eAAa,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;IAE3D,MAAM,WAAW,GAAG,IAAIC,MAAI,CAAC,EAAE,EAAE,WAAW,CAAC,CAAC;IAC9C,MAAM,UAAU,GAAG,IAAIA,MAAI,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC;IAC5C,MAAM,QAAQ,GAAG,IAAIA,MAAI,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;IAExC,UAAU,GAAG,IAAIT,aAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IACjE,UAAU,CAAC,cAAc,GAAG,SAAS,CAAC;;IAGtC,MAAM,QAAQ,GAAG,IAAIU,cAAY,CAAC,EAAE,CAAC,CAAC;IACtC,IAAI,GAAG,IAAIC,cAAY,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;;IAG9C,MAAM,QAAQ,GAAG,IAAIJ,gBAAc,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAC/C,MAAM,QAAQ,GAAG,IAAIE,MAAI,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;IACxC,MAAM,OAAO,GAAG,IAAIG,eAAa,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IAC7C,OAAO,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;IAClC,MAAM,GAAG,IAAID,cAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;;IAG7C,MAAM,UAAU,GAAG,IAAIL,aAAW,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAClD,MAAM,UAAU,GAAG,IAAIG,MAAI,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC;IAC5C,MAAM,SAAS,GAAG,IAAIT,aAAW,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAC/E,WAAW,GAAG,EAAE,CAAC;IACjB,KAAK,MAAM,GAAG,IAAI,eAAe,EAAE;QAC/B,MAAM,EAAE,GAAG,IAAIW,cAAY,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QACnD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,YAAY,EAAE,EAAE,CAAC,YAAY,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3E,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KACxB;;IAGD,MAAM,OAAO,GAAG,IAAIC,eAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;;IAE5D,OAAO,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;IACvC,GAAG,GAAG,IAAID,cAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IAC1C,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,YAAY,EAAE,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;;IAI9E,OAAO,GAAG,EAAE,CAAC;IACb,MAAM,QAAQ,GAAG,CAAC,CAAC;IACnB,MAAM,QAAQ,GAAG,CAAC,CAAC;IACnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,QAAQ,EAAE,CAAC,EAAE,EAAE;QAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,QAAQ,EAAE,CAAC,EAAE,EAAE;YAChC,MAAM,GAAG,GAAG,IAAIX,aAAW,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACpG,GAAG,CAAC,cAAc,GAAG,UAAU,CAAC,cAAc,CAAC;YAC/C,GAAG,CAAC,kBAAkB,GAAG,OAAO,CAAC;YACjC,GAAG,CAAC,YAAY,GAAG,OAAO,CAAC;YAC3B,MAAM,CAAC,GAAG,IAAIW,cAAY,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;YAC7C,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAEhB,MAAM,KAAK,GAAG,CAAC,CAAC,YAAY,CAAC;YAC7B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACrB,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,QAAQ,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;;;SAGnF;KACJ;AACL,CAAC;AAED,SAAS,MAAM;IACX,IAAI,IAAI,CAAC,EAAE,CAAC;QAAE,MAAM,CAAC,eAAe,CAAC,eAAe,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;SAChE,IAAI,IAAI,CAAC,EAAE,CAAC;QAAE,MAAM,CAAC,eAAe,CAAC,eAAe,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;IAC3E,IAAI,IAAI,CAAC,EAAE,CAAC;QAAE,MAAM,CAAC,eAAe,CAAC,eAAe,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;SAC7D,IAAI,IAAI,CAAC,EAAE,CAAC;QAAE,MAAM,CAAC,eAAe,CAAC,eAAe,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;IACxE,IAAI,IAAI,CAAC,EAAE,CAAC;QAAE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACtD,IAAI,IAAI,CAAC,EAAE,CAAC;QAAE,MAAM,CAAC,eAAe,CAAC,eAAe,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;IAEhE,MAAM,CAAC,oBAAoB,CAAC,CAAC,aAAa,EAAE,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;IAClE,aAAa,GAAG,CAAC,CAAC;IAClB,aAAa,GAAG,CAAC,CAAC;IAElB,SAAS,EAAE,CAAC;IACZ,qBAAqB,CAAC,MAAM,CAAC,CAAC;AAClC,CAAC;AAED,SAAS,SAAS;IACd,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,GAAG,EAAE,CAAC,gBAAgB,CAAC,CAAC;IAEpD,MAAM,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;IAElC,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;;IAGvD,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;IAC1B,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;IACzB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IACnC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,YAAY,EAAE,MAAM,CAAC,YAAY,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;IAC1E,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,EAAE,MAAM,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IAElE,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;IAClD,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;IACxB,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;;;;IAOzB,KAAK,MAAM,EAAE,IAAI,WAAW;QAAE,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;IAE5E,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE;QAC1B,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;KACrD;IAED,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;IACpB,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,mBAAmB,CAAC,CAAC;IACnD,EAAE,CAAC,iBAAiB,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,mBAAmB,EAAE,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,mBAAmB,CAAC,CAAC;IAC3F,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;IAEhD,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;AACzB,CAAC;AAED,MAAM,CAAC,SAAS,GAAG,UAAS,CAAgB;IACxC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC;AAC3B,CAAC,CAAC;AAEF,MAAM,CAAC,OAAO,GAAG,UAAS,CAAgB;IACtC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;AAC5B,CAAC,CAAC;AAEF;;;;AAIA,SAAS,cAAc,CAAC,GAAS,EAAE,CAAS,EAAE,CAAS;IACnD,MAAM,KAAK,GAAG,CAAC,CAAC,GAAG,GAAG,IAAI,IAAI,CAAC,EAAE,CAAC;IAClC,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;IAE5B,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC1C,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC1B,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAE1C,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACvB,OAAO,GAAG,CAAC;AACf"}