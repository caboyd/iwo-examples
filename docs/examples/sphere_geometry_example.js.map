{"version":3,"file":"sphere_geometry_example.js","sources":["../../examples/sphere_geometry_example.ts"],"sourcesContent":["import { glMatrix, mat4, vec3 } from \"gl-matrix\";\r\nimport * as IWO from \"iwo/src/iwo\";\r\n\r\nlet canvas: HTMLCanvasElement;\r\nlet gl: WebGL2RenderingContext;\r\n\r\nconst view_matrix: mat4 = mat4.create();\r\nconst proj_matrix: mat4 = mat4.create();\r\n\r\nconst cPos: vec3 = vec3.fromValues(0.5, 8, 9.0);\r\nlet camera: IWO.Camera;\r\n\r\nlet mouse_x_total = 0;\r\nlet mouse_y_total = 0;\r\nconst keys: Array<boolean> = [];\r\n\r\nlet spheres: IWO.MeshInstance[];\r\nlet sphere_mat: IWO.Material;\r\nlet grid: IWO.MeshInstance;\r\nlet renderer: IWO.Renderer;\r\n\r\ndocument.getElementById(\"loading-text-wrapper\")!.remove();\r\n\r\nconst moveCallback = (e: MouseEvent): void => {\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    //@ts-ignore\r\n    const movementX = e.movementX || e.mozMovementX || e.webkitMovementX || 0;\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    //@ts-ignore\r\n    const movementY = e.movementY || e.mozMovementY || e.webkitMovementY || 0;\r\n    if (e.which == 1) {\r\n        mouse_x_total += movementX;\r\n        mouse_y_total += movementY;\r\n    }\r\n};\r\n\r\nconst stats = (): void => {\r\n    const script = document.createElement(\"script\");\r\n    script.onload = (): void => {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        //@ts-ignore\r\n        const stats = new Stats();\r\n        document.body.appendChild(stats.dom);\r\n        requestAnimationFrame(function loop() {\r\n            stats.update();\r\n            requestAnimationFrame(loop);\r\n        });\r\n    };\r\n    script.src = \"//rawgit.com/mrdoob/stats.js/master/build/stats.min.js\";\r\n    document.head.appendChild(script);\r\n};\r\n\r\n(function main(): void {\r\n    stats();\r\n\r\n    canvas = <HTMLCanvasElement>document.getElementById(\"canvas\");\r\n    document.addEventListener(\"mousemove\", moveCallback, false);\r\n\r\n    gl = initGL();\r\n\r\n    renderer = new IWO.Renderer(gl);\r\n\r\n    window.addEventListener(\"resize\", resizeCanvas, false);\r\n\r\n    function resizeCanvas(): void {\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n        renderer.setViewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n        mat4.perspective(\r\n            proj_matrix,\r\n            glMatrix.toRadian(90),\r\n            gl.drawingBufferWidth / gl.drawingBufferHeight,\r\n            0.1,\r\n            1000.0\r\n        );\r\n    }\r\n\r\n    resizeCanvas();\r\n\r\n    camera = new IWO.Camera(cPos);\r\n\r\n    gl.clearColor(173 / 255, 196 / 255, 221 / 255, 1.0);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.cullFace(gl.BACK);\r\n\r\n    renderer.setViewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    mat4.perspective(proj_matrix, glMatrix.toRadian(90), gl.drawingBufferWidth / gl.drawingBufferHeight, 0.1, 1000.0);\r\n\r\n    const sun_dir = [-0.3, 0, 1];\r\n    const sun_intensity = 4;\r\n    const sun_color = [(sun_intensity * 254) / 255, (sun_intensity * 238) / 255, (sun_intensity * 224) / 255];\r\n\r\n    const pbrShader = IWO.PBRMaterial.Shader;\r\n    pbrShader.use();\r\n    pbrShader.setUniform(\"u_lights[0].position\", [sun_dir[0], sun_dir[1], sun_dir[2], 0]);\r\n    pbrShader.setUniform(\"u_lights[0].color\", sun_color);\r\n    pbrShader.setUniform(\"u_light_count\", 1);\r\n\r\n    initScene();\r\n\r\n    requestAnimationFrame(update);\r\n})();\r\n\r\nfunction initGL(): WebGL2RenderingContext {\r\n    try {\r\n        gl = <WebGL2RenderingContext>canvas.getContext(\"webgl2\");\r\n    } catch (e) {\r\n        throw new Error(\"GL init error:\\n\" + e);\r\n    }\r\n\r\n    if (!gl) {\r\n        alert(\"WebGL is not available on your browser.\");\r\n    }\r\n    return gl;\r\n}\r\n\r\nfunction initScene(): void {\r\n    const plane_geom = new IWO.PlaneGeometry(100, 100, 1, 1, true).getBufferedGeometry();\r\n    const plane_mesh = new IWO.Mesh(gl, plane_geom);\r\n\r\n    sphere_mat = new IWO.PBRMaterial(vec3.fromValues(1, 1, 1), 0, 0, 2);\r\n\r\n    //GRID\r\n    const grid_mat = new IWO.GridMaterial(50);\r\n    grid = new IWO.MeshInstance(plane_mesh, grid_mat);\r\n\r\n    //SPHERES\r\n    spheres = [];\r\n    const num_cols = 8;\r\n    const num_rows = 8;\r\n    for (let i = 0; i <= num_cols; i++) {\r\n        for (let k = 0; k <= num_rows; k++) {\r\n            const sphere_geom = IWO.BufferedGeometry.fromGeometry(new IWO.SphereGeometry(0.75, 3 + i * 2, 2 + k * 2));\r\n            const sphere_mesh = new IWO.Mesh(gl, sphere_geom);\r\n            const s = new IWO.MeshInstance(sphere_mesh, sphere_mat);\r\n            spheres.push(s);\r\n            const model = s.model_matrix;\r\n            mat4.identity(model);\r\n            mat4.translate(model, model, vec3.fromValues((i - num_cols / 2) * 2, 2 * num_rows - k * 2, 0));\r\n        }\r\n    }\r\n}\r\n\r\nfunction update(): void {\r\n    if (keys[87]) camera.processKeyboard(IWO.Camera_Movement.FORWARD, 0.001);\r\n    else if (keys[83]) camera.processKeyboard(IWO.Camera_Movement.BACKWARD, 0.001);\r\n    if (keys[65]) camera.processKeyboard(IWO.Camera_Movement.LEFT, 0.001);\r\n    else if (keys[68]) camera.processKeyboard(IWO.Camera_Movement.RIGHT, 0.001);\r\n    if (keys[82]) camera.lookAt(vec3.fromValues(0, 0, 0));\r\n    if (keys[32]) camera.processKeyboard(IWO.Camera_Movement.UP, 0.001);\r\n\r\n    camera.processMouseMovement(-mouse_x_total, -mouse_y_total, true);\r\n    mouse_x_total = 0;\r\n    mouse_y_total = 0;\r\n\r\n    drawScene();\r\n    requestAnimationFrame(update);\r\n}\r\n\r\nfunction drawScene(): void {\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n    camera.getViewMatrix(view_matrix);\r\n    renderer.setPerFrameUniforms(view_matrix, proj_matrix);\r\n\r\n    for (const sphere of spheres) {\r\n        sphere.render(renderer, view_matrix, proj_matrix);\r\n    }\r\n\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    grid.render(renderer, view_matrix, proj_matrix);\r\n    gl.disable(gl.BLEND);\r\n}\r\n\r\nwindow.onkeydown = function(e: KeyboardEvent): void {\r\n    keys[e.keyCode] = true;\r\n};\r\n\r\nwindow.onkeyup = function(e: KeyboardEvent): void {\r\n    keys[e.keyCode] = false;\r\n};\r\n"],"names":["IWO.Renderer","IWO.Camera","IWO.PBRMaterial","IWO.PlaneGeometry","IWO.Mesh","IWO.GridMaterial","IWO.MeshInstance","IWO.BufferedGeometry","IWO.SphereGeometry","IWO.Camera_Movement"],"mappings":"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"}